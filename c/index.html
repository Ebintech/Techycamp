<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Campaign...</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: #eef2ff;
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }

        .loading-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.95);
            z-index: 50;
            align-items: center;
            justify-content: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .app-container {
            width: 100%;
            max-width: 480px;
            background: #fff;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
        }

        /* HEADER SECTION - Blue Gradient */
        .header {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 60%, #4338ca 100%);
            /* Deep Navy/Blue */
            padding: 24px 20px 50px;
            /* Reduced vertical padding */
            color: white;
            border-bottom-left-radius: 24px;
            border-bottom-right-radius: 24px;
            text-align: center;
            position: relative;
        }

        /* Header Elements */
        .badge {
            background: rgba(255, 255, 255, 0.15);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
            /* Tighter spacing */
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 24px;
            /* Slightly smaller for compact look */
            font-weight: 700;
            margin-bottom: 4px;
            letter-spacing: -0.5px;
        }

        .header p {
            font-size: 13px;
            opacity: 0.8;
            margin-bottom: 20px;
            font-weight: 400;
        }

        /* CASHBACK CARD - Green        /* REWARD SECTION */
        .cashback-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            /* Kept original blur for consistency with other glassy elements */
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 16px;
            /* Kept original padding */
            margin: 0 auto -40px;
            /* Kept original margin for overlap */
            width: 90%;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 10;
            opacity: 0;
            /* Silent loading */
            transform: translateY(10px);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .cashback-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .cashback-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #ecfccb;
            /* Slight Lime Tint for readability */
            font-weight: 700;
            margin-bottom: 4px;
        }

        .cashback-amount-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .cashback-amount {
            font-size: 32px;
            font-weight: 800;
            color: #fff;
            line-height: 1;
        }

        /* Specific Green Icon Container */
        .wallet-icon-container {
            width: 36px;
            height: 36px;
            background: rgba(16, 185, 129, 0.2);
            /* Green tint bg */
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(16, 185, 129, 0.4);
        }

        .icon-svg {
            width: 20px;
            height: 20px;
            color: #34d399;
            /* Bright Green Icon */
        }

        /* Track Status Button INSIDE Card? User image has it inside. Let's try inside as per image? No, user said "Track Status should be as it is on our last code no change on it" - which was below submit button. But the image shows it inside. The user specifically said "track lead status should be as it is on our last code no change on it" -> assuming BELOW submit button. */

        /* FORM SECTION */
        .content-area {
            padding: 50px 20px 40px;
            /* Top padding for overlap */
            background: #fff;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            color: #64748b;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 6px;
            letter-spacing: 0.5px;
        }

        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            font-size: 18px;
            pointer-events: none;
        }

        .form-input {
            width: 100%;
            padding: 14px 14px 14px 44px;
            /* Compact padding */
            border: 1px solid #e2e8f0;
            background: #f8fafc;
            border-radius: 12px;
            font-size: 15px;
            color: #1e293b;
            font-weight: 500;
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            background: #fff;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* SUBMIT BUTTON */
        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(90deg, #10b981, #059669);
            /* Green CTA per Image 1? Or keep Purple? User asked for Blue Header but Image 1 has Green Button. Let's match Header Theme -> Purple/Blue for consistency unless specified. User said "the colour theme we need is like this" referring to Blue. I will stick to Purple Button. */
            background: linear-gradient(90deg, #6366f1, #4f46e5);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 8px;
        }

        /* TRACK STATUS LINK (Below Submit) */
        .track-status-container {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 24px;
        }

        .track-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #ef4444;
            font-size: 12px;
            font-weight: 700;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 16px;
            border-radius: 8px;
            background: #fff1f2;
            transition: background 0.2s;
        }

        /* ACCORDIONS - Clean White Style */
        .accordion-section {
            border: 1px solid #f1f5f9;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .accordion-header {
            width: 100%;
            padding: 14px 16px;
            /* Compact padding */
            background: #fff;
            border: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-align: left;
            cursor: pointer;
            border-bottom: 1px solid transparent;
        }

        .accordion-header.active {
            border-bottom: 1px solid #f1f5f9;
            background: #f8fafc;
        }

        .accordion-title {
            font-weight: 600;
            font-size: 14px;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .accordion-icon {
            color: #94a3b8;
            transition: transform 0.3s;
        }

        .accordion-header.active .accordion-icon {
            transform: rotate(180deg);
            color: #6366f1;
        }

        .accordion-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: #fff;
            padding: 0 16px;
        }

        .accordion-body.open {
            padding: 12px 16px;
            max-height: 1000px;
        }

        .step-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .step-list li {
            position: relative;
            padding-left: 20px;
            margin-bottom: 8px;
            font-size: 13px;
            line-height: 1.5;
            color: #475569;
        }

        .step-list li::before {
            content: "‚úì";
            color: white;
            background: #10b981;
            font-weight: bold;
            font-size: 9px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            left: 0;
            top: 3px;
        }

        /* Icons inside Accordion Titles */
        .acc-icon-bg {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            margin-right: 4px;
        }

        /* TELEGRAM BUTTON (Footer) */
        .telegram-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px;
            background: #0ea5e9;
            color: white;
            font-weight: 600;
            border-radius: 12px;
            text-decoration: none;
            margin-top: 16px;
            font-size: 14px;
        }

        /* STATES */
        .section-hidden {
            display: none !important;
        }

        .state-container {
            padding: 60px 20px;
            text-align: center;
        }

        .state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            display: block;
        }

        .state-title {
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .state-desc {
            font-size: 14px;
            color: #64748b;
            margin-bottom: 24px;
        }

        /* Loading Dots */
        @keyframes pulse {
            0% {
                transform: scale(0.95);
                opacity: 0.5;
            }

            50% {
                transform: scale(1.05);
                opacity: 1;
            }

            100% {
                transform: scale(0.95);
                opacity: 0.5;
            }
        }

        .loading-dots div {
            width: 10px;
            height: 10px;
            background: #6366f1;
            border-radius: 50%;
            margin: 0 4px;
            animation: pulse 1s infinite;
        }

        .loading-dots div:nth-child(2) {
            animation-delay: 0.2s;
        }

        .loading-dots div:nth-child(3) {
            animation-delay: 0.4s;
        }
    </style>
</head>

<body>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-dots">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <!-- Main Application Container -->
    <div class="app-container">

        <!-- 1. ERROR STATE -->
        <div id="errorView" class="state-container section-hidden">
            <span class="state-icon">‚ùå</span>
            <h2 class="state-title">Campaign Not Found</h2>
            <p class="state-desc">This offer is unavailable or the link is incorrect.</p>
        </div>

        <!-- 2. ENDED STATE -->
        <div id="campaignEnded" class="state-container section-hidden">
            <span class="state-icon">‚è∞</span>
            <h2 class="state-title">Offer Expired</h2>
            <p class="state-desc">This campaign has ended. Stay tuned for new offers!</p>
        </div>

        <!-- 3. SUCCESS STATE -->
        <div id="successView" class="state-container section-hidden">
            <span class="state-icon">‚úÖ</span>
            <h2 class="state-title">Submission Successful!</h2>
            <p class="state-desc">Redirecting you to the offer page...<br>Please complete the steps to earn cashback.
            </p>
        </div>

        <!-- 4. ACTIVE FORM VIEW -->
        <div id="formView">
            <!-- Header -->
            <div class="header">
                <div class="badge">
                    <span>üéÅ</span> COMPLETE & EARN
                </div>
                <h1 id="campaignName">Loading...</h1>
                <p id="campaignDescription">Complete the offer to get instant cashback!</p>

                <!-- Compact Cashback Card -->
                <div class="cashback-card">
                    <div class="cashback-label">YOUR CASHBACK REWARD</div>
                    <div class="cashback-amount-row">
                        <span class="cashback-amount" id="campaignPayout">‚Çπ0</span>

                        <!-- Green Wallet Icon Container -->
                        <div class="wallet-icon-container">
                            <!-- SVG Wallet Icon -->
                            <svg class="icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z">
                                </path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <form id="campaignForm">
                    <div id="formFieldsContainer">
                        <!-- Dynamic Fields will be injected here -->
                    </div>

                    <!-- Honeypot -->
                    <input type="text" name="website" style="display:none" tabindex="-1" autocomplete="off">

                    <!-- Submit Button -->
                    <button type="submit" class="submit-btn" id="submitBtn">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        Claim Reward
                    </button>
                </form>

                <!-- Track Status Link (Original Request: Below Submit) -->
                <div class="track-status-container">
                    <a href="#" id="trackStatusLink" class="track-link">
                        Track Your Leads Status ‚Üí
                    </a>
                </div>

                <!-- How to Avail (Open by Default) -->
                <div class="accordion-section">
                    <button class="accordion-header active" onclick="toggleAccordion(this)">
                        <span class="accordion-title">
                            <span class="acc-icon-bg" style="background:#eff6ff; color:#6366f1;">
                                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </span>
                            How to Complete
                        </span>
                        <svg class="accordion-icon" width="20" height="20" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </button>
                    <div class="accordion-body open" style="max-height: 1000px;">
                        <ul class="step-list" id="stepsContainer">
                            <!-- Steps Injected Here -->
                        </ul>
                    </div>
                </div>

                <!-- Terms (Collapsed) -->
                <div class="accordion-section">
                    <button class="accordion-header" onclick="toggleAccordion(this)">
                        <span class="accordion-title">
                            <span class="acc-icon-bg" style="background:#fef2f2; color:#ef4444;">
                                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                    </path>
                                </svg>
                            </span>
                            Terms & Conditions
                        </span>
                        <svg class="accordion-icon" width="20" height="20" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </button>
                    <div class="accordion-body">
                        <ul class="step-list" id="termsContainer">
                            <!-- Terms Injected Here -->
                        </ul>
                    </div>
                </div>

                <!-- Telegram Button -->
                <a href="https://t.me/yourchannel" target="_blank" class="telegram-btn">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                        <path
                            d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z" />
                    </svg>
                    Join Our Telegram Channel
                </a>

            </div>
        </div>

    </div>

    <!-- Scripts -->
    <script src="../campaigns-config.js"></script>
    <script>
        // ================================
        // CONFIG & STATE
        // ================================
        const WORKER_API = 'https://campaign-apii.businesstechy04.workers.dev';
        const urlParams = new URLSearchParams(window.location.search);
        const campaignId = urlParams.get('o') || urlParams.get('v') || urlParams.get('id') || 'bww4yubb';
        const clickId = urlParams.get('click_id') || urlParams.get('source');
        const refId = urlParams.get('ref');
        const tgLink = urlParams.get('tg'); // Get Telegram Link from URL

        let currentCampaign = null;

        // ================================
        // INITIALIZATION
        // ================================
        document.addEventListener('DOMContentLoaded', () => {
            // Handle Telegram Button Logic immediately
            const tgBtn = document.querySelector('.telegram-btn');
            if (tgBtn) {
                if (tgLink) {
                    tgBtn.href = tgLink;
                } else {
                    tgBtn.href = 'https://t.me/camptechy';
                }
            }

            if (typeof CAMPAIGNS !== 'undefined') {
                init();
            } else {
                setTimeout(init, 500);
            }
        });

        async function init() {
            currentCampaign = (typeof getCampaign === 'function') ? getCampaign(campaignId) : CAMPAIGNS[campaignId];

            if (!currentCampaign) {
                toggleSection('errorView');
                return;
            }

            if (currentCampaign.active === false) {
                toggleSection('campaignEnded');
                return;
            }

            let customRewardValue = null;

            // SILENT PRE-FETCH (No dots, no flicker)
            if (refId) {
                console.log('Syncing custom reward for Ref:', refId);
                try {
                    const syncPromise = fetch(`${WORKER_API}/register-referrer`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            type: 'getReferrerInfo',
                            ref: refId,
                            secretKey: 'Techybaanupxty892546',
                            cacheBust: Date.now()
                        })
                    }).then(res => res.ok ? res.json() : null);

                    // Wait up to 2.5 seconds for custom reward
                    const timeoutPromise = new Promise(resolve => setTimeout(() => resolve(null), 2500));
                    const data = await Promise.race([syncPromise, timeoutPromise]);

                    if (data && data.success) {
                        console.log('Sync Data Received:', data);
                        // Sync Telegram
                        if (data.telegram && data.telegram !== 'https://t.me/camptechy') {
                            const telegramBtn = document.querySelector('.telegram-btn');
                            if (telegramBtn) telegramBtn.href = data.telegram;
                        }
                        // Set custom reward
                        if (data.payoutReferee !== undefined && data.payoutReferee !== null) {
                            customRewardValue = data.payoutReferee;
                        }
                    }
                } catch (e) {
                    console.error('Silent sync failed:', e);
                }
            }

            // FINAL RENDER (Direct)
            await loadCampaignUI(customRewardValue);

            // Show the reward card once data is ready
            const card = document.querySelector('.cashback-card');
            if (card) card.classList.add('visible');
        }

        function toggleSection(viewId) {
            ['formView', 'errorView', 'campaignEnded', 'successView'].forEach(id => {
                document.getElementById(id).classList.add('section-hidden');
            });
            document.getElementById(viewId).classList.remove('section-hidden');
        }

        async function loadCampaignUI(customAmt = null) {
            document.title = currentCampaign.name;
            document.getElementById('campaignName').textContent = currentCampaign.name;
            document.getElementById('campaignDescription').textContent = "Complete the offer to get instant cashback!";

            // Priority: customAmt > config.payout
            const finalAmt = customAmt !== null ? customAmt : currentCampaign.payout;
            document.getElementById('campaignPayout').textContent = `‚Çπ${finalAmt}`;

            // Track Status Links
            const trackerUrl = `../tracker/index.html?id=${campaignId}`;
            document.getElementById('trackStatusLink').href = trackerUrl;

            renderFormFields();

            // DYNAMIC STEPS: Replace reward amount in the last step
            const steps = [...(currentCampaign.steps || [])];
            if (steps.length > 0) {
                const i = steps.length - 1;
                // Regex replaces any price mention like ‚Çπ50 or ‚Çπ500
                steps[i] = steps[i].replace(/‚Çπ[0-9]+/g, `‚Çπ${finalAmt}`);
            }

            const stepsContainer = document.getElementById('stepsContainer');
            stepsContainer.innerHTML = steps.map(step => `<li>${step}</li>`).join('');

            const termsContainer = document.getElementById('termsContainer');
            termsContainer.innerHTML = (currentCampaign.terms || []).map(term => `<li>${term}</li>`).join('');
        }

        function renderFormFields() {
            const container = document.getElementById('formFieldsContainer');
            container.innerHTML = '';

            const fields = currentCampaign.requiredFields || ['upi'];

            fields.forEach(field => {
                const group = document.createElement('div');
                group.className = 'form-group';

                let label = '';
                let placeholder = '';
                let type = 'text';
                let icon = '';
                let validation = '';

                if (field === 'name') {
                    label = 'Enter Your Name';
                    placeholder = 'e.g. John Doe';
                    icon = 'üë§';
                    validation = `pattern="[a-zA-Z\\s]{2,50}" oninput="this.value = this.value.replace(/[^a-zA-Z\\s]/g, '')"`;
                } else if (field === 'mobile') {
                    label = 'Mobile Number';
                    placeholder = '10-digit number';
                    type = 'tel';
                    icon = 'üì±';
                    validation = `pattern="[6-9][0-9]{9}" maxlength="10" oninput="this.value = this.value.replace(/[^0-9]/g, '')"`;
                } else if (field === 'upi') {
                    label = 'Your UPI ID';
                    placeholder = 'e.g. name@upi';
                    icon = '@';
                    validation = `pattern="[a-zA-Z0-9.\\-_]{2,}@[a-zA-Z]{2,}" oninput="this.value = this.value.trim()"`;
                }

                group.innerHTML = `
                    <label class="input-label">${label} <span style="color:#ef4444">*</span></label>
                    <div class="input-wrapper">
                        <span class="input-icon">${icon}</span>
                        <input 
                            type="${type}" 
                            id="${field}" 
                            class="form-input" 
                            placeholder="${placeholder}" 
                            required 
                            ${validation}
                        >
                    </div>
                `;
                container.appendChild(group);
            });
        }

        window.toggleAccordion = function (btn) {
            const content = btn.nextElementSibling;
            const isOpen = content.classList.contains('open');

            if (isOpen) {
                content.style.maxHeight = null;
                content.classList.remove('open');
                btn.classList.remove('active');
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
                content.classList.add('open');
                btn.classList.add('active');
            }
        };

        document.getElementById('campaignForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const overlay = document.getElementById('loadingOverlay');

            const formData = {};
            const fields = currentCampaign.requiredFields || ['upi'];
            let isValid = true;

            fields.forEach(f => {
                const val = document.getElementById(f).value.trim();
                if (!val) isValid = false;
                formData[f] = val;
            });

            if (!isValid) {
                alert("Please fill all fields correctly.");
                return;
            }

            submitBtn.disabled = true;
            submitBtn.innerHTML = 'Processing...';
            overlay.classList.add('active');

            try {
                const uniqueClickId = clickId || ('C' + Date.now().toString(36).toUpperCase() + Math.random().toString(36).substring(2, 5).toUpperCase());

                const payload = {
                    ...formData,
                    clickId: uniqueClickId,
                    campaignId: campaignId,
                    campaignSlug: currentCampaign.slug,
                    referrerId: refId || null,
                    website: document.querySelector('[name="website"]').value,
                    origin: window.location.origin
                };

                const res = await fetch(WORKER_API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await res.json();

                if (!result.success) throw new Error(result.error || 'Failed');

                overlay.classList.remove('active');
                toggleSection('successView');

                setTimeout(() => {
                    window.location.replace(result.redirectUrl);
                }, 2000);

            } catch (err) {
                console.error(err);
                alert("Submission failed. Please try again.");
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Claim Reward';
                overlay.classList.remove('active');
            }
        });
    </script>
</body>

</html>
